var syg_name,syg_room_num,syg_role,current_stats_role,latest_move_dict,game_state,$mapdiv,$mapimg,$mapcanvas,$select,canvas,ctx,sc,factor,socket,graph,vx_balls,vy_balls,game_has_started=!1;function load_stuff(){syg_name=window.localStorage.getItem("syg_name"),syg_room_num=window.localStorage.getItem("syg_room_num"),current_stats_role=syg_role="",latest_move_dict={},game_state={},$mapdiv=$("#map-div"),$mapimg=$("#map-img"),$mapcanvas=$("#map-canvas"),$select=null,canvas=document.getElementById("map-canvas"),ctx=canvas.getContext("2d"),sc=JSON.parse(station_coordinates),factor=1,graph=new Graph;create_balls(6),vx_balls=[],vy_balls=[];for(var a=0;a<6;a++)vx_balls.push(Math.random()<.5?10:-10),vy_balls.push(Math.random()<.5?10:-10);move_balls(),syg_name&&syg_room_num&&parseInt(window.location.pathname.slice(-5,-1))==syg_room_num||(alert("Something is wrong :(; Go to "+window.location.host+"/scotland_yard to reset"),syg_room_num=0),$mapcanvas.css({top:$mapimg.position().top,left:$mapimg.position().left}),canvas.height=$mapimg.height(),canvas.width=$mapimg.width();var e="https:"==window.location.protocol?"wss://":"ws://";(socket=new WebSocket(e+window.location.host+"/ws/scotland_yard/"+syg_room_num+"/")).addEventListener("open",function(a){console.log("Socket established"),socket.send(JSON.stringify({purpose:"setup_server",name:syg_name}))}),socket.addEventListener("close",function(a){console.log("Socket closed "+a.code),3069===a.code&&(window.onbeforeunload=function(){},setTimeout(function(){alert("GG WP"),window.location.href=window.location.href.slice(0,-5).replace("game/","")},1e4))}),$("#toggle-fullscreen").click(),$mapcanvas.click(mapcanvas_click()),socket_message(),document.addEventListener("keyup",handleKey)}$(document).ready(function(){load_stuff()}),window.onbeforeunload=function(){return"Leaving a game midway is not good for health"},$("#status").fadeOut(30);